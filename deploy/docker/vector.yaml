# Vector config for Docker log collection

sources:
  docker_logs:
    type: docker_logs

transforms:
  docker_parsed:
    type: remap
    inputs:
      - docker_logs
    source: |
      .service = .container_name
      .host = .host
      .raw = .message
      .meta = {}

      # Default level
      .level = "INFO"

      # Detect level from message
      msg = string!(.message)
      if contains(msg, "ERROR") || contains(msg, "error") {
        .level = "ERROR"
      } else if contains(msg, "WARN") || contains(msg, "warn") {
        .level = "WARN"
      } else if contains(msg, "DEBUG") || contains(msg, "debug") {
        .level = "DEBUG"
      }

sinks:
  purl:
    type: http
    inputs:
      - docker_parsed
    uri: "${PURL_URL:-http://purl:3000}/api/logs"
    encoding:
      codec: json
    batch:
      max_events: 100
      timeout_secs: 5
